<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Numerimondes Asset Viewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .slide-in-right {
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out;
    }
    .slide-in-right.active {
      transform: translateX(0);
    }
    .backdrop-blur {
      backdrop-filter: blur(8px);
    }
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-4">
          <h1 class="text-xl font-bold text-gray-900">
            <img src="https://raw.githubusercontent.com/numerimondes/.github/refs/heads/main/assets/brands/numerimondes/identity/logos/v2/logo_entier_v3.png" 
            style="width:280px;padding:10px;">
          </h1>
          <span id="loadingBadge" class="hidden bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
            Loading...
          </span>
        </div>
        <div class="flex items-center space-x-3">
          <select id="filterType" class="border border-gray-300 px-3 py-2 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="all">ğŸŒ All</option>
            <option value="brands">ğŸ¢ Brands</option>
            <option value="clients">ğŸ‘¥ Clients</option>
            <option value="projects">ğŸš€ Projects</option>
          </select>
          <button id="helpBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm transition-colors">
            â“ Help
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Stats -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      <div class="bg-white rounded-lg p-4 shadow-sm border">
        <div class="text-2xl font-bold text-blue-600" id="totalCount">0</div>
        <div class="text-sm text-gray-600">Total Assets</div>
      </div>
      <div class="bg-white rounded-lg p-4 shadow-sm border">
        <div class="text-2xl font-bold text-green-600" id="brandsCount">0</div>
        <div class="text-sm text-gray-600">Brands</div>
      </div>
      <div class="bg-white rounded-lg p-4 shadow-sm border">
        <div class="text-2xl font-bold text-purple-600" id="clientsCount">0</div>
        <div class="text-sm text-gray-600">Clients</div>
      </div>
      <div class="bg-white rounded-lg p-4 shadow-sm border">
        <div class="text-2xl font-bold text-orange-600" id="projectsCount">0</div>
        <div class="text-sm text-gray-600">Projects</div>
      </div>
    </div>

    <!-- Search -->
    <div class="mb-6">
      <input 
        id="searchInput" 
        type="text" 
        placeholder="ğŸ” Search for an asset..."
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
      >
    </div>

    <!-- Assets Grid -->
    <div id="assetGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <!-- Loading skeletons -->
      <div class="skeleton bg-white rounded-lg p-6 h-80"></div>
      <div class="skeleton bg-white rounded-lg p-6 h-80"></div>
      <div class="skeleton bg-white rounded-lg p-6 h-80"></div>
      <div class="skeleton bg-white rounded-lg p-6 h-80"></div>
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="hidden text-center py-12">
      <div class="text-6xl mb-4">ğŸ“</div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No assets found</h3>
      <p class="text-gray-500">Try adjusting your filters or search</p>
    </div>
  </main>

  <!-- Preview Modal -->
  <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-75 backdrop-blur flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
      <div class="flex justify-between items-center p-4 border-b">
        <h3 id="modalTitle" class="text-lg font-semibold text-gray-900"></h3>
        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div id="modalContent" class="p-6 overflow-auto max-h-[calc(90vh-80px)]">
        <!-- Dynamic content -->
      </div>
    </div>
  </div>

  <!-- Help Sidebar -->
  <div id="helpSidebar" class="fixed inset-y-0 right-0 w-96 bg-white shadow-xl border-l slide-in-right z-50 overflow-y-auto">
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold text-gray-900">ğŸ“‹ Asset Naming Convention</h2>
        <button id="closeHelp" class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="space-y-6">
        <div>
          <h3 class="font-semibold text-gray-900 mb-3">ğŸ—ï¸ Folder Structure</h3>
          <div class="bg-gray-50 p-3 rounded-lg text-sm font-mono">
            <div>assets/</div>
            <div>â”œâ”€â”€ brands/</div>
            <div>â”œâ”€â”€ clients/</div>
            <div>â”œâ”€â”€ projects/</div>
            <div>â””â”€â”€ commons/</div>
          </div>
        </div>

        <div>
          <h3 class="font-semibold text-gray-900 mb-3">ğŸ¯ Automatically Detected Assets</h3>
          <div class="space-y-3">
            <div class="bg-blue-50 p-3 rounded-lg">
              <div class="font-medium text-blue-900">Main Logo</div>
              <div class="text-sm text-blue-700">identity/logos/v*/[name]*.{png,jpg,svg}</div>
            </div>
            <div class="bg-green-50 p-3 rounded-lg">
              <div class="font-medium text-green-900">Web Banner</div>
              <div class="text-sm text-green-700">marketing/banners/web/*.{png,jpg}</div>
            </div>
            <div class="bg-purple-50 p-3 rounded-lg">
              <div class="font-medium text-purple-900">Team Photo</div>
              <div class="text-sm text-purple-700">team/photos/optimized/*.{jpg,png}</div>
            </div>
            <div class="bg-orange-50 p-3 rounded-lg">
              <div class="font-medium text-orange-900">OG Image</div>
              <div class="text-sm text-orange-700">identity/preview/og-image/*.{png,jpg}</div>
            </div>
          </div>
        </div>

        <div>
          <h3 class="font-semibold text-gray-900 mb-3">ğŸ” Features</h3>
          <ul class="space-y-2 text-sm text-gray-600">
            <li>â€¢ Automatic exploration via assets-links.txt</li>
            <li>â€¢ Filtering by type (brands, clients, projects)</li>
            <li>â€¢ Real-time search</li>
            <li>â€¢ Modal preview with view/download options</li>
            <li>â€¢ Responsive design</li>
            <li>â€¢ Source file handling with are_downloadable check</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Backdrop -->
  <div id="helpBackdrop" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur hidden z-40"></div>

  <script>
    // Configuration
    const CONFIG = {
      BASE_RAW_URL: 'https://raw.githubusercontent.com/numerimondes/.github/refs/heads/main',
      ASSETS_LINKS_URL: 'https://raw.githubusercontent.com/numerimondes/.github/refs/heads/main/assets/commons/config/assets-links.txt',
      MAX_DEPTH: 4,
      ASSET_PATTERNS: {
        logo: ['identity/logos/v1', 'identity/logos/v2'],
        banner: ['marketing/banners/web'],
        teamPhoto: ['team/photos/optimized'],
        ogImage: ['identity/preview/og-image', 'identity/preview/og-image/v1']
      },
      SUPPORTED_EXTENSIONS: {
        image: ['.png', '.jpg', '.jpeg', '.svg', '.webp'],
        document: ['.pdf', '.doc', '.docx', '.md', '.txt'],
        video: ['.mp4', '.webm', '.mov'],
        audio: ['.mp3', '.wav', '.ogg'],
        script: ['.sh']
      }
    };

    // Application state
    let allAssets = [];
    let filteredAssets = [];
    
    // DOM elements
    const elements = {
      grid: document.getElementById('assetGrid'),
      filterType: document.getElementById('filterType'),
      searchInput: document.getElementById('searchInput'),
      loadingBadge: document.getElementById('loadingBadge'),
      totalCount: document.getElementById('totalCount'),
      brandsCount: document.getElementById('brandsCount'),
      clientsCount: document.getElementById('clientsCount'),
      projectsCount: document.getElementById('projectsCount'),
      emptyState: document.getElementById('emptyState'),
      helpBtn: document.getElementById('helpBtn'),
      helpSidebar: document.getElementById('helpSidebar'),
      helpBackdrop: document.getElementById('helpBackdrop'),
      closeHelp: document.getElementById('closeHelp')
    };

    // Function to get file type
    function getFileType(filename) {
      const ext = filename.toLowerCase().substring(filename.lastIndexOf('.') || filename.length);
      for (const [type, extensions] of Object.entries(CONFIG.SUPPORTED_EXTENSIONS)) {
        if (extensions.includes(ext)) return type;
      }
      return 'other';
    }

    // Function to fetch and parse assets-links.txt
    async function fetchAssetsLinks() {
      try {
        const response = await fetch(CONFIG.ASSETS_LINKS_URL);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const text = await response.text();
        return text.split('\n').filter(line => line.trim()).map(url => ({
          url,
          path: url.replace(CONFIG.BASE_RAW_URL + '/', ''),
          name: url.split('/').pop(),
          isSource: url.includes('/sources/'),
          parentDir: url.substring(0, url.lastIndexOf('/'))
        }));
      } catch (error) {
        console.error('Error fetching assets-links.txt:', error);
        throw error;
      }
    }

    // Function to check if a source file is downloadable
    function isSourceDownloadable(file, allFiles) {
      if (!file.isSource) return true;
      return allFiles.some(f => f.parentDir === file.parentDir && f.name === 'are_downloadable');
    }

    // Function to explore files for an entity
    function exploreFilesForEntity(entityPath, entityName, entityType, allFiles) {
      const files = allFiles
        .filter(f => f.path.startsWith(entityPath) && !f.name.includes('.gitkeep') && f.name !== 'README.md')
        .map(f => ({
          name: f.name,
          path: f.path,
          downloadUrl: f.url,
          type: getFileType(f.name),
          isSource: f.isSource,
          isDownloadable: isSourceDownloadable(f, allFiles)
        }));
      return files;
    }

    // Function to detect assets
    function detectAssets(files, entityPath, entityName, entityType) {
      const assets = {
        name: entityName,
        type: entityType,
        path: entityPath,
        logo: null,
        banner: null,
        teamPhoto: null,
        ogImage: null,
        allFiles: files
      };

      for (const pattern of CONFIG.ASSET_PATTERNS.logo) {
        const logoFiles = files.filter(f => 
          f.path.includes(`${entityPath}/${pattern}`) && 
          f.type === 'image' &&
          !f.isSource
        );
        if (logoFiles.length > 0) {
          assets.logo = logoFiles.find(f => 
            f.name.toLowerCase().includes(entityName.toLowerCase()) || 
            f.name.includes('logo')
          ) || logoFiles[0];
          break;
        }
      }

      for (const pattern of CONFIG.ASSET_PATTERNS.banner) {
        const bannerFiles = files.filter(f => 
          f.path.includes(`${entityPath}/${pattern}`) && 
          f.type === 'image'
        );
        if (bannerFiles.length > 0) {
          assets.banner = bannerFiles[0];
          break;
        }
      }

      for (const pattern of CONFIG.ASSET_PATTERNS.teamPhoto) {
        const teamFiles = files.filter(f => 
          f.path.includes(`${entityPath}/${pattern}`) && 
          f.type === 'image'
        );
        if (teamFiles.length > 0) {
          assets.teamPhoto = teamFiles[0];
          break;
        }
      }

      for (const pattern of CONFIG.ASSET_PATTERNS.ogImage) {
        const ogFiles = files.filter(f => 
          f.path.includes(`${entityPath}/${pattern}`) && 
          f.type === 'image' &&
          !f.isSource
        );
        if (ogFiles.length > 0) {
          assets.ogImage = ogFiles[0];
          break;
        }
      }

      return assets;
    }

    // Main function to load all assets
    async function loadAllAssets() {
      console.log('Starting asset loading');
      showLoading(true);
      allAssets = [];

      try {
        const allFiles = await fetchAssetsLinks();
        console.log(`Fetched ${allFiles.length} files from assets-links.txt`);

        const entityTypes = [
          { type: 'brands', prefix: 'assets/brands/' },
          { type: 'clients', prefix: 'assets/clients/' },
          { type: 'projects', prefix: 'assets/projects/' }
        ];

        for (const { type, prefix } of entityTypes) {
          console.log(`Processing ${type}`);
          const entities = [...new Set(
            allFiles
              .filter(f => f.path.startsWith(prefix))
              .map(f => {
                const parts = f.path.split('/');
                if (type === 'clients') {
                  // Clients have deeper nesting: assets/clients/morocco/asso|ste/entity
                  return parts.slice(0, 5).join('/');
                }
                return parts.slice(0, 3).join('/');
              })
          )];

          console.log(`Found ${entities.length} entities for ${type}`);

          for (const entityPath of entities) {
            const entityName = entityPath.split('/').pop();
            let files;

            if (type === 'clients') {
              // For clients, process the deepest level (e.g., le-cafe-litteraire-de-fes)
              files = exploreFilesForEntity(entityPath, entityName, type, allFiles);
            } else {
              files = exploreFilesForEntity(entityPath, entityName, type, allFiles);
            }

            console.log(`Detected ${files.length} files for ${entityPath}`);
            const asset = detectAssets(files, entityPath, entityName, type);
            allAssets.push(asset);
            console.log(`Added asset: ${type}/${entityName}`);
          }
        }

        console.log(`Total assets loaded: ${allAssets.length}`);
        updateStats();
        filterAndRenderAssets();
      } catch (error) {
        console.error('Error loading assets:', error);
        showError(`Unable to load assets: ${error.message}`);
      } finally {
        showLoading(false);
      }
    }

    // Function to show/hide loading state
    function showLoading(show) {
      console.log(`Setting loading state: ${show}`);
      elements.loadingBadge.classList.toggle('hidden', !show);
      if (!show) {
        elements.grid.querySelectorAll('.skeleton').forEach(s => s.remove());
        console.log('Removed loading skeletons');
      }
    }

    // Function to update statistics
    function updateStats() {
      console.log('Updating statistics');
      const counts = {
        total: allAssets.length,
        brands: allAssets.filter(a => a.type === 'brands').length,
        clients: allAssets.filter(a => a.type === 'clients').length,
        projects: allAssets.filter(a => a.type === 'projects').length
      };

      elements.totalCount.textContent = counts.total;
      elements.brandsCount.textContent = counts.brands;
      elements.clientsCount.textContent = counts.clients;
      elements.projectsCount.textContent = counts.projects;
      console.log('Statistics updated:', counts);
    }

    // Function to filter assets and render
    function filterAndRenderAssets() {
      console.log('Filtering and rendering assets');
      const filterType = elements.filterType.value;
      const searchTerm = elements.searchInput.value.toLowerCase();
      console.log(`Filter type: ${filterType}, Search term: ${searchTerm}`);

      filteredAssets = allAssets.filter(asset => {
        const matchesType = filterType === 'all' || asset.type === filterType;
        const matchesSearch = asset.name.toLowerCase().includes(searchTerm);
        return matchesType && matchesSearch;
      });
      console.log(`Filtered ${filteredAssets.length} assets`);

      renderAssets();
    }

    // Function to render assets
    function renderAssets() {
      console.log('Rendering assets');
      elements.grid.innerHTML = '';
      elements.emptyState.classList.add('hidden');

      if (filteredAssets.length === 0) {
        console.log('No assets to display');
        elements.emptyState.classList.remove('hidden');
        return;
      }

      filteredAssets.forEach(asset => {
        const card = createAssetCard(asset);
        elements.grid.appendChild(card);
        console.log(`Rendered card for ${asset.name}`);
      });
    }

    // Function to create an asset card
    function createAssetCard(asset) {
      console.log(`Creating card for ${asset.name} (${asset.type})`);
      const card = document.createElement('div');
      card.className = 'bg-white rounded-lg shadow-sm border hover:shadow-md transition-all duration-200 p-6 group';

      const typeEmojis = {
        brands: 'ğŸ¢',
        clients: 'ğŸ‘¥',
        projects: 'ğŸš€'
      };

      const hasAssets = asset.logo || asset.banner || asset.teamPhoto || asset.ogImage;

      card.innerHTML = `
        <div class="text-center space-y-4">
          <div class="flex justify-between items-start mb-3">
            <span class="text-xs px-2 py-1 rounded-full ${getTypeColor(asset.type)} font-medium">
              ${typeEmojis[asset.type]} ${asset.type}
            </span>
            <button onclick="showAllAssets('${asset.name}', '${asset.type}')" 
                    class="text-gray-400 hover:text-gray-600 text-sm opacity-100">
              ğŸ“ ${asset.allFiles.length}
            </button>
          </div>

          ${asset.logo ? `
            <div class="w-24 h-24 mx-auto mb-4 bg-gray-50 rounded-lg flex items-center justify-center overflow-hidden border">
              <img src="${asset.logo.downloadUrl}" 
                   alt="Logo ${asset.name}" 
                   class="max-w-full max-h-full object-contain cursor-pointer hover:scale-105 transition-transform"
                   onclick="showPreview('${asset.logo.downloadUrl}', 'Logo - ${asset.name}', '${asset.logo.type}')">
            </div>
          ` : '<div class="w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400">ğŸ“„</div>'}

          <h3 class="font-semibold text-gray-900 text-lg capitalize">${asset.name.replace(/-/g, ' ')}</h3>
          
          <div class="space-y-2">
            ${asset.banner ? `
              <button onclick="showPreview('${asset.banner.downloadUrl}', 'Banner - ${asset.name}', '${asset.banner.type}')" 
                      class="block w-full text-blue-600 hover:text-blue-800 text-sm hover:bg-blue-50 py-1 px-2 rounded transition-colors">
                ğŸ¯ View Banner
              </button>
            ` : ''}
            
            ${asset.teamPhoto ? `
              <button onclick="showPreview('${asset.teamPhoto.downloadUrl}', 'Team - ${asset.name}', '${asset.teamPhoto.type}')" 
                      class="block w-full text-green-600 hover:text-green-800 text-sm hover:bg-green-50 py-1 px-2 rounded transition-colors">
                ğŸ‘¥ View Team
              </button>
            ` : ''}
            
            ${asset.ogImage ? `
              <button onclick="showPreview('${asset.ogImage.downloadUrl}', 'OG Image - ${asset.name}', '${asset.ogImage.type}')" 
                      class="block w-full text-purple-600 hover:text-purple-800 text-sm hover:bg-purple-50 py-1 px-2 rounded transition-colors">
                ğŸ–¼ï¸ View OG Image
              </button>
            ` : ''}
          </div>

          ${!hasAssets ? '<p class="text-gray-500 text-sm mt-4">No main assets detected</p>' : ''}
        </div>
      `;
      
      console.log(`Card created for ${asset.name}`);
      return card;
    }

    // Function to get type color
    function getTypeColor(type) {
      const colors = {
        brands: 'bg-blue-100 text-blue-800',
        clients: 'bg-green-100 text-green-800',
        projects: 'bg-purple-100 text-purple-800'
      };
      const color = colors[type] || 'bg-gray-100 text-gray-800';
      console.log(`Color for ${type}: ${color}`);
      return color;
    }

    // Function to show preview
    function showPreview(url, title, fileType) {
      console.log(`Showing preview for ${title} (type: ${fileType})`);
      const modal = document.getElementById('previewModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalContent = document.getElementById('modalContent');

      modalTitle.textContent = title;

      if (fileType === 'image') {
        modalContent.innerHTML = `
          <div class="text-center">
            <img src="${url}" alt="${title}" class="max-w-full max-h-[60vh] mx-auto rounded-lg shadow-lg" />
            <div class="mt-4 p-4 bg-gray-50 rounded-lg">
              <p class="text-sm text-gray-600 mb-2">Image URL:</p>
              <input type="text" value="${url}" readonly 
                     class="w-full px-3 py-2 bg-white border rounded text-sm font-mono" 
                     onclick="this.select()">
            </div>
          </div>
        `;
      } else {
        modalContent.innerHTML = `
          <div class="text-center">
            <div class="text-6xl mb-4">ğŸ“„</div>
            <p class="text-gray-600 mb-4">Preview not available for this file type</p>
            <a href="${url}" target="_blank" 
               class="inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
              ğŸ”— Open File
            </a>
          </div>
        `;
      }

      modal.classList.remove('hidden');
      console.log('Preview modal opened');
    }

    // Function to show all assets for an entity
    function showAllAssets(entityName, entityType) {
      console.log(`Showing all assets for ${entityName} (${entityType})`);
      const asset = allAssets.find(a => a.name === entityName && a.type === entityType);
      if (!asset) {
        console.error(`No asset found for ${entityName} (${entityType})`);
        return;
      }

      const modal = document.getElementById('previewModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalContent = document.getElementById('modalContent');

      modalTitle.textContent = `ğŸ“ All Files - ${entityName}`;

      const filesByType = {
        image: asset.allFiles.filter(f => f.type === 'image'),
        document: asset.allFiles.filter(f => f.type === 'document'),
        video: asset.allFiles.filter(f => f.type === 'video'),
        audio: asset.allFiles.filter(f => f.type === 'audio'),
        script: asset.allFiles.filter(f => f.type === 'script'),
        other: asset.allFiles.filter(f => f.type === 'other')
      };

      let content = '<div class="space-y-6">';
      
      Object.entries(filesByType).forEach(([type, files]) => {
        if (files.length > 0) {
          const typeEmojis = {
            image: 'ğŸ–¼ï¸',
            document: 'ğŸ“„',
            video: 'ğŸ¬',
            audio: 'ğŸµ',
            script: 'ğŸ“œ',
            other: 'ğŸ“'
          };
          console.log(`Rendering ${files.length} ${type} files`);
          content += `
            <div>
              <h3 class="font-semibold text-gray-900 mb-3 flex items-center">
                ${typeEmojis[type]} ${type.charAt(0).toUpperCase() + type.slice(1)} (${files.length})
              </h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          `;
          
          files.forEach(file => {
            const fileName = file.name;
            const filePath = file.path.replace(asset.path + '/', '');
            const isSourceLabel = file.isSource ? '<span class="text-xs text-orange-600 ml-2">[Source]</span>' : '';
            const downloadButton = file.isDownloadable ? `
              <a href="${file.downloadUrl}" download 
                 class="ml-2 text-green-600 hover:text-green-800 text-sm">
                â¬‡ï¸
              </a>
            ` : '';

            content += `
              <div class="border rounded-lg p-3 hover:bg-gray-50 transition-colors">
                <div class="flex items-center justify-between">
                  <div class="flex-1 min-w-0">
                    <p class="font-medium text-sm text-gray-900 truncate">${fileName}${isSourceLabel}</p>
                    <p class="text-xs text-gray-500 truncate">${filePath}</p>
                  </div>
                  <div class="flex items-center">
                    <a href="${file.downloadUrl}" target="_blank" 
                       class="ml-2 text-blue-600 hover:text-blue-800 text-sm">
                      ğŸ‘ï¸
                    </a>
                    ${downloadButton}
                  </div>
                </div>
              </div>
            `;
          });
          
          content += '</div></div>';
        }
      });
      
      content += '</div>';
      modalContent.innerHTML = content;
      modal.classList.remove('hidden');
      console.log('All assets modal opened');
    }

    // Function to close modal
    function closeModal() {
      console.log('Closing modal');
      document.getElementById('previewModal').classList.add('hidden');
    }

    // Function to show error
    function showError(message) {
      console.error('Displaying error:', message);
      elements.grid.innerHTML = `
        <div class="col-span-full text-center py-12">
          <div class="text-6xl mb-4">âš ï¸</div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">Error</h3>
          <p class="text-gray-500">${message}</p>
        </div>
      `;
    }

    // Help sidebar handlers
    elements.helpBtn.addEventListener('click', () => {
      console.log('Opening help sidebar');
      elements.helpSidebar.classList.add('active');
      elements.helpBackdrop.classList.remove('hidden');
    });

    elements.closeHelp.addEventListener('click', closeHelp);
    elements.helpBackdrop.addEventListener('click', closeHelp);

    function closeHelp() {
      console.log('Closing help sidebar');
      elements.helpSidebar.classList.remove('active');
      elements.helpBackdrop.classList.add('hidden');
    }

    // Event listeners for filtering and search
    elements.filterType.addEventListener('change', () => {
      console.log('Filter type changed');
      filterAndRenderAssets();
    });
    elements.searchInput.addEventListener('input', () => {
      console.log('Search input changed');
      filterAndRenderAssets();
    });

    // Initialize
    console.log('Initializing asset viewer');
    loadAllAssets();
  </script>
</body>
</html>
