<!--- code_name = WebLinksFetcher --->

<!--
  WebLinksFetcher
  --------------------
  Copyright (C) 2025 El Moumen Yassine

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program. If not, see <https://www.gnu.org/licenses/>.

  About Numerimondes
  -----------------
  Numerimondes is a dynamic technology and consulting ecosystem based in Morocco,
  dedicated to empowering innovation through growth thinking, brand thinking,
  design thinking, and tech thinking. We craft tools and strategies that make
  development intuitive, collaborative, and impactful. Our mission is to build a vibrant
  community of innovators, connecting businesses, developers, and visionaries to shape
  a better future through technology.

  Our flagship projects, such as WebKernel and Nadim, alongside tailored solutions like
  SolEcoles, provide robust, open-source tools for web development, automation, and
  industry-specific applications. Numerimondes combines elegant technical solutions
  with strategic consulting to drive success for businesses and communities.

  Compatibility Note:
  -------------------
  WebKernel, the skeleton project on which this project builds, is licensed under
  the Mozilla Public License (MPL). Both MPL and GPL v3 are open source licenses,
  but they have different conditions. Since WebLinksFetcher is GPLv3-licensed, 
  any derivative work must comply with GPLv3 terms. MPL's file-level copyleft can
  coexist with GPLv3, but care must be taken in how combined code is distributed.

  For detailed compatibility, please consult:
  - https://www.gnu.org/licenses/license-list.en.html#MPL
  - https://www.mozilla.org/en-US/MPL/2.0/
-->

<!--
  Mission:
  Numerimondes empowers creators by providing expressive, modular tools such as
  WebKernel, a scalable web framework, and Nadim, powerful automation scripts.
  Our ecosystem supports collaboration, innovation, and tailored solutions,
  especially for sectors like education with projects like SolEcoles.
-->


<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Numerimondes Asset Viewer</title>
  <!-- OG Metadata -->
  <meta property="og:title" content="Numerimondes Asset Viewer" />
  <meta property="og:description" content="Explore and manage assets for Numerimondes brands, clients and projects." />
  <meta property="og:image" content="https://raw.githubusercontent.com/numerimondes/.github/refs/heads/main/assets/commons/media/images/og-image-WebLinksFetcher.png" />
  <meta property="og:url" content="https://numerimondes.github.io/.github/" />
  <meta property="og:type" content="website" />
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Numerimondes Asset Viewer" />
  <meta name="twitter:description" content="Explore and manage assets for Numerimondes brands, clients and projects." />
  <meta name="twitter:image" content="https://raw.githubusercontent.com/numerimondes/.github/refs/heads/main/assets/commons/media/images/og-image-WebLinksFetcher.png" />
  <!-- Other Meta -->
  <meta name="description" content="A modern asset viewer for Numerimondes, featuring logos, banners, team photos and more for brands, clients and projects." />
  <meta name="keywords" content="Numerimondes, assets, brands, clients, projects, media" />
  <meta name="author" content="El Moumen Yassine" />
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=https://numerimondes.com/&size=256" />
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
  <!-- Highlight.js for Syntax Highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/markdown.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <!-- Marked.js for Markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    /* CSS Variables for easy color customization */
:root {
  /* Primary Colors */
  --primary-bg: #0d1117;           /* GitHub dark background */
  --secondary-bg: #161b22;         /* Lighter background for cards */
  --tertiary-bg: #21262d;          /* Even lighter for headers */
  --accent-bg: #30363d;            /* Accent background */
  
  /* Text Colors */
  --primary-text: #f0f6fc;         /* Primary text color */
  --secondary-text: #8b949e;       /* Secondary text color */
  --muted-text: #6e7681;           /* Muted text color */
  
  /* Border Colors */
  --border-primary: #30363d;       /* Primary border color */
  --border-secondary: #21262d;     /* Secondary border color */
  
  /* Accent Colors */
  --accent-blue: #58a6ff;          /* Blue accent */
  --accent-green: #3fb950;         /* Green accent */
  --accent-purple: #a5a5ff;        /* Purple accent */
  --accent-orange: #ff9500;        /* Orange accent */
  --accent-red: #f85149;           /* Red accent */
  
  /* Interactive States */
  --hover-bg: #262c36;             /* Hover background */
  --active-bg: #316dca;            /* Active background */
  --focus-ring: #1f6feb;           /* Focus ring color */

/* Source Code Modal Specific Styles */

--page-sourcecode-modal-width: 95vw;
  --page-sourcecode-modal-height: 95vh;
}

.page-sourcecode-modal .modal-content {
  width: var(--page-sourcecode-modal-width);
  max-width: var(--page-sourcecode-modal-width);
  height: var(--page-sourcecode-modal-height);
  max-height: var(--page-sourcecode-modal-height);
}


/* Base Styles */
* {
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background-color: var(--primary-bg);
  color: var(--primary-text);
  margin: 0;
  padding: 0;
  min-height: 100vh;
  line-height: 1.6;
  display: flex;
  flex-direction: column;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--primary-bg);
}

::-webkit-scrollbar-thumb {
  background: var(--border-primary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--secondary-text);
}

/* Header Styles */
.header {
  background-color: var(--secondary-bg);
  border-bottom: 1px solid var(--border-primary);
  position: sticky;
  top: 0;
  z-index: 40;
  backdrop-filter: blur(8px);
}

.container {
  max-width: 1280px;
  margin: 0 auto;
  padding: 0 1rem;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 4rem;
}

.logo-section {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.logo-title {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 700;
}

.logo-image {
  height: 2rem;
  width: auto;
  padding: 0.25rem;
}

.loading-badge {
  background-color: var(--accent-blue);
  color: var(--primary-bg);
  font-size: 0.75rem;
  padding: 0.25rem 0.5rem;
  border-radius: 9999px;
  font-weight: 500;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

/* View Toggle Styles */
.view-toggle {
  display: flex;
  border-radius: 0.5rem;
  overflow: hidden;
  border: 1px solid var(--border-primary);
}

.view-toggle-btn {
  padding: 0.5rem 0.75rem;
  background-color: var(--secondary-bg);
  color: var(--primary-text);
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.875rem;
}

.view-toggle-btn:hover {
  background-color: var(--hover-bg);
}

.view-toggle-btn.active {
  background-color: var(--accent-blue);
  color: var(--primary-bg);
}

.view-toggle-btn .icon {
  width: 1.25rem;
  height: 1.25rem;
}

.btn-text {
  display: none;
}

@media (min-width: 640px) {
  .btn-text {
    display: inline;
  }
}

/* Grid Size Control */
.grid-size-control {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background-color: var(--secondary-bg);
  border: 1px solid var(--border-primary);
  border-radius: 0.5rem;
  padding: 0.25rem;
}

.grid-size-btn {
  padding: 0.25rem 0.5rem;
  background: none;
  border: none;
  color: var(--secondary-text);
  cursor: pointer;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 500;
  transition: all 0.2s ease;
  min-width: 2rem;
}

.grid-size-btn:hover {
  background-color: var(--hover-bg);
  color: var(--primary-text);
}

.grid-size-btn.active {
  background-color: var(--accent-blue);
  color: var(--primary-bg);
}

/* Filter Select */
.filter-select {
  background-color: var(--secondary-bg);
  color: var(--primary-text);
  border: 1px solid var(--border-primary);
  padding: 0.5rem 0.75rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.2s ease;
}

.filter-select:focus {
  outline: none;
  border-color: var(--focus-ring);
  box-shadow: 0 0 0 2px rgba(31, 111, 235, 0.3);
}

.filter-select option {
  background-color: var(--secondary-bg);
  color: var(--primary-text);
}

/* Help Button */
.help-btn {
  background-color: var(--accent-blue);
  color: var(--primary-bg);
  border: none;
  padding: 0.5rem 0.75rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-weight: 500;
}

.help-btn:hover {
  background-color: #4493f8;
}

.help-text {
  display: none;
}

@media (min-width: 640px) {
  .help-text {
    display: inline;
  }
}

/* Main Content */
.main-content {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem 1rem;
  flex: 1 0 auto;
  min-height: calc(100vh - 200px);
  width: 100%;
  position: relative;
}

/* Prevent content shifting */
.stats-grid,
.search-container,
.owner-filter-container {
  width: 100%;
  margin-left: 0;
  margin-right: 0;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}

@media (min-width: 768px) {
  .stats-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

.stat-card {
  background-color: var(--secondary-bg);
  border-radius: 0.75rem;
  padding: 1rem;
  border: 1px solid var(--border-primary);
  transition: transform 0.2s ease;
}

.stat-card:hover {
  transform: translateY(-2px);
  border-color: var(--border-secondary);
}

.stat-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--accent-blue);
  margin-bottom: 0.25rem;
}

.stat-value.brands {
  color: var(--accent-green);
}

.stat-value.clients {
  color: var(--accent-purple);
}

.stat-value.projects {
  color: var(--accent-orange);
}

.stat-value.commons {
  color: var(--accent-blue);
}

.stat-label {
  font-size: 0.875rem;
  color: var(--secondary-text);
}

/* Search Container */
.search-container {
  position: relative;
  margin-bottom: 1.5rem;
}

.search-input {
  width: 100%;
  padding: 0.75rem 1rem;
  padding-right: 2.5rem;
  background-color: var(--secondary-bg);
  color: var(--primary-text);
  border: 1px solid var(--border-primary);
  border-radius: 0.5rem;
  font-size: 1rem;
  transition: all 0.2s ease;
}

.search-input:focus {
  outline: none;
  border-color: var(--focus-ring);
  box-shadow: 0 0 0 2px rgba(31, 111, 235, 0.3);
}

.search-input::placeholder {
  color: var(--muted-text);
}

.clear-search-btn {
  position: absolute;
  right: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--secondary-text);
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 0.25rem;
  transition: color 0.2s ease;
}

.clear-search-btn:hover {
  color: var(--primary-text);
}

.clear-search-btn .icon {
  width: 1.25rem;
  height: 1.25rem;
}

/* Asset Grid */
.asset-grid {
  display: grid;
  gap: 1.5rem;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  justify-items: start;
}

.asset-grid.grid-3 {
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
}

.asset-grid.grid-4 {
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}

.asset-grid.grid-5 {
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
}

@media (min-width: 1024px) {
  .asset-grid.grid-3 {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .asset-grid.grid-4 {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .asset-grid.grid-5 {
    grid-template-columns: repeat(5, 1fr);
  }
}

/* Asset Card */
.asset-card {
  background-color: var(--secondary-bg);
  border: 1px solid var(--border-primary);
  border-radius: 0.75rem;
  padding: 1.5rem;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transform: translateZ(0);
  width: 100%;
  max-width: 400px;
}

.asset-card:hover {
  transform: translateY(-8px) scale(1.02);
  border-color: var(--accent-blue);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(88, 166, 255, 0.3);
}

.asset-card:active {
  transform: translateY(-4px) scale(1.01);
}

.asset-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1rem;
}

.asset-type-badge {
  padding: 0.25rem 0.5rem;
  border-radius: 0.375rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.asset-type-badge.brands {
  background-color: rgba(63, 185, 80, 0.2);
  color: var(--accent-green);
}

.asset-type-badge.clients {
  background-color: rgba(165, 165, 255, 0.2);
  color: var(--accent-purple);
}

.asset-type-badge.projects {
  background-color: rgba(255, 149, 0, 0.2);
  color: var(--accent-orange);
}

.asset-type-badge.commons {
  background-color: rgba(88, 166, 255, 0.2);
  color: var(--accent-blue);
}

.asset-preview {
  width: 100%;
  height: 160px;
  border-radius: 0.5rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--tertiary-bg);
  border: 1px solid var(--border-secondary);
  overflow: hidden;
  position: relative;
}

.asset-preview img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  border-radius: 0.375rem;
}

.asset-placeholder {
  color: var(--muted-text);
  font-size: 2.5rem;
}

.asset-actions {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  display: flex;
  gap: 0.25rem;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.asset-card:hover .asset-actions {
  opacity: 1;
}

.action-btn {
  background-color: rgba(0, 0, 0, 0.7);
  color: white;
  border: none;
  padding: 0.5rem;
  border-radius: 0.25rem;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.action-btn:hover {
  background-color: rgba(0, 0, 0, 0.9);
  transform: scale(1.1);
}

.action-btn .icon {
  width: 1rem;
  height: 1rem;
}

.asset-info {
  margin-top: auto;
}

.asset-title {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--primary-text);
  line-height: 1.4;
}

.asset-path {
  font-size: 0.875rem;
  color: var(--secondary-text);
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
  word-break: break-all;
}

/* Loading Spinner */
.loading-spinner {
  display: inline-block;
  width: 1.5rem;
  height: 1.5rem;
  border: 2px solid var(--border-primary);
  border-radius: 50%;
  border-top-color: var(--accent-blue);
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Loading State */
.loading-state {
  text-align: center;
  padding: 4rem 2rem;
  color: var(--secondary-text);
}

.loading-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.loading-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--primary-text);
}

.loading-description {
  font-size: 1rem;
  margin-bottom: 2rem;
}

.progress-bar {
  width: 100%;
  max-width: 320px;
  height: 4px;
  background-color: var(--border-primary);
  border-radius: 2px;
  margin: 0 auto;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background-color: var(--accent-blue);
  width: 0%;
  transition: width 0.3s ease;
  border-radius: 2px;
}

/* Error State */
.error-state {
  text-align: center;
  padding: 4rem 2rem;
  color: var(--secondary-text);
}

.error-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
  color: var(--accent-red);
}

.error-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--primary-text);
}

.error-description {
  font-size: 1rem;
  margin-bottom: 2rem;
  max-width: 480px;
  margin-left: auto;
  margin-right: auto;
  line-height: 1.6;
}

.retry-btn {
  background-color: var(--accent-blue);
  color: var(--primary-bg);
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 500;
}

.retry-btn:hover {
  background-color: #4493f8;
  transform: translateY(-1px);
}

.retry-btn .icon {
  width: 1.25rem;
  height: 1.25rem;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  color: var(--secondary-text);
}

.empty-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.empty-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--primary-text);
}

.empty-description {
  font-size: 1rem;
  max-width: 480px;
  margin: 0 auto;
  line-height: 1.6;
}

/* List View Styles */
.asset-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.asset-list-item {
  background-color: var(--secondary-bg);
  border: 1px solid var(--border-primary);
  border-radius: 0.5rem;
  padding: 1rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  transition: all 0.2s ease;
  cursor: pointer;
  position: relative;
}

.asset-list-item:hover {
  border-color: var(--accent-blue);
  background-color: var(--hover-bg);
}

.asset-list-item:hover .asset-actions {
  opacity: 1;
}

.asset-list-preview {
  width: 64px;
  height: 64px;
  border-radius: 0.375rem;
  background-color: var(--tertiary-bg);
  border: 1px solid var(--border-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  overflow: hidden;
}

.asset-list-preview img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

.asset-list-preview .asset-placeholder {
  font-size: 1.5rem;
}

.asset-list-info {
  flex: 1;
  min-width: 0;
}

.asset-list-title {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
  color: var(--primary-text);
}

.asset-list-path {
  font-size: 0.875rem;
  color: var(--secondary-text);
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
  word-break: break-all;
}

.asset-list-badge {
  flex-shrink: 0;
}

/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 50;
  padding: 1rem;
  overflow-y: auto;
}

.modal.show {
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background-color: var(--secondary-bg);
  border-radius: 0.75rem;
  border: 1px solid var(--border-primary);
  width: 100%;
  max-width: 900px;
  max-height: 95vh;
  overflow: hidden;
  animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(-20px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid var(--border-primary);
}

.modal-title {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
}

.modal-close {
  background: none;
  border: none;
  color: var(--secondary-text);
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 0.25rem;
  transition: color 0.2s ease;
}

.modal-close:hover {
  color: var(--primary-text);
}

.modal-close .icon {
  width: 1.5rem;
  height: 1.5rem;
}

.modal-body {
  padding: 1.5rem;
  max-height: 75vh;
  overflow: auto;
}

.modal-preview {
  width: 100%;
  max-height: 600px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--tertiary-bg);
  border-radius: 0.5rem;
  border: 1px solid var(--border-secondary);
  margin-bottom: 1.5rem;
  overflow: auto;
  position: relative;
}

.modal-preview img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

.modal-preview .markdown-content {
  padding: 1rem;
  width: 100%;
  max-height: 350px;
  overflow-y: auto;
  text-align: left;
}

.modal-preview .markdown-content pre {
  background-color: var(--primary-bg);
  padding: 1rem;
  border-radius: 0.5rem;
  overflow-x: auto;
  border: 1px solid var(--border-primary);
}

.modal-preview .markdown-content code {
  background-color: var(--primary-bg);
  padding: 0.125rem 0.25rem;
  border-radius: 0.25rem;
  font-size: 0.875rem;
}

.modal-actions {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

.modal-action-btn {
  background-color: var(--accent-blue);
  color: var(--primary-bg);
  border: none;
  padding: 0.75rem 1rem;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 500;
  font-size: 0.875rem;
}

.modal-action-btn:hover {
  background-color: #4493f8;
  transform: translateY(-1px);
}

.modal-action-btn.secondary {
  background-color: var(--tertiary-bg);
  color: var(--primary-text);
}

.modal-action-btn.secondary:hover {
  background-color: var(--hover-bg);
}

.modal-action-btn .icon {
  width: 1rem;
  height: 1rem;
}

.modal-info {
  display: grid;
  gap: 0.75rem;
}

.modal-info-item {
  display: grid;
  grid-template-columns: 120px 1fr;
  gap: 0.75rem;
  align-items: start;
}

.modal-info-label {
  font-weight: 600;
  color: var(--secondary-text);
  font-size: 0.875rem;
}

.modal-info-value {
  color: var(--primary-text);
  font-size: 0.875rem;
  word-break: break-all;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
}

/* Unified Filter Container */
.unified-filter-container {
  display: flex;
  gap: 0;
  margin-bottom: 2rem;
  align-items: flex-start;
  flex-wrap: nowrap;
  overflow-x: auto;
}

@media (max-width: 768px) {
  .unified-filter-container {
    flex-wrap: wrap;
    gap: 1rem;
  }
}

/* Owner Filter Styles */
.owner-filter-container {
  display: none;
  min-width: 0;
}

.owner-filter-container.show {
  display: flex;
  flex-direction: column;
}

.owner-filter-title {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 1rem;
  color: var(--primary-text);
}

.owner-filter-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  max-width: 100%;
  padding: 0.25rem 0;
}

.owner-filter-grid::-webkit-scrollbar {
  height: 6px;
}

.owner-filter-grid::-webkit-scrollbar-track {
  background: var(--primary-bg);
}

.owner-filter-grid::-webkit-scrollbar-thumb {
  background: var(--border-primary);
  border-radius: 3px;
}

.owner-filter-item {
  background-color: var(--secondary-bg);
  border: 1px solid var(--border-primary);
  border-radius: 0.75rem;
  padding: 1rem;
  cursor: pointer;
  transition: transform 0.2s ease;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.25rem;
  height: auto;
  min-height: auto;
  flex: 0 0 auto;
  min-width: fit-content;
  width: auto;
}

/* Adaptive width for filter items - stat-card style */
.owner-filter-item {
  min-width: 120px;
  max-width: 200px;
}

/* Responsive adjustments for mobile */
@media (max-width: 768px) {
  .owner-filter-item {
    min-width: 100px;
    max-width: 160px;
  }
}

.owner-filter-item:hover {
  transform: translateY(-2px);
  border-color: var(--border-secondary);
}

.owner-filter-item.active {
  border-color: var(--accent-blue);
  background-color: rgba(88, 166, 255, 0.1);
}

.owner-filter-logo {
  width: 40px;
  height: 40px;
  border-radius: 0.375rem;
  object-fit: cover;
  border: 1px solid var(--border-secondary);
}

.owner-filter-emoji {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--accent-blue);
  margin-bottom: 0.25rem;
}

.owner-filter-name {
  font-size: 0.875rem;
  color: var(--secondary-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  margin: 0;
}

.keyboard-shortcut {
  background-color: var(--tertiary-bg);
  color: var(--primary-text);
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  font-family: 'SF Mono', Monaco, monospace;
  font-size: 0.75rem;
  border: 1px solid var(--border-primary);
  display: inline-block;
  margin: 0.125rem;
}

/* Footer Styles */
.footer {
  background-color: var(--secondary-bg);
  border-top: 1px solid var(--border-primary);
  padding: 2rem 1rem;
  margin-top: 4rem;
  text-align: center;
  flex-shrink: 0;
}

.footer-content {
  max-width: 1280px;
  margin: 0 auto;
}

.footer-logo {
  width: 8rem;
  margin-bottom: 1rem;
}

.footer-text {
  color: var(--secondary-text);
  font-size: 0.875rem;
  margin-bottom: 1rem;
}

.footer-links {
  display: flex;
  justify-content: center;
  gap: 2rem;
  margin-bottom: 1rem;
}

.footer-link {
  color: var(--accent-blue);
  text-decoration: none;
  font-size: 0.875rem;
  transition: color 0.2s ease;
}

.footer-link:hover {
  color: var(--primary-text);
}

.footer-copyright {
  color: var(--muted-text);
  font-size: 0.75rem;
}

/* Responsive Design */
@media (max-width: 768px) {
  .header-content {
    flex-direction: column;
    gap: 1rem;
    height: auto;
    padding: 1rem 0;
  }
  
  .header-controls {
    width: 100%;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  
  .stats-grid {
    grid-template-columns: 1fr 1fr;
  }
  
  .modal-content {
    margin: 1rem;
    max-height: calc(100vh - 2rem);
  }
  
  .modal-info-item {
    grid-template-columns: 1fr;
    gap: 0.25rem;
  }
  
  .modal-actions {
    flex-direction: column;
  }
  
  .footer-links {
    flex-direction: column;
    gap: 1rem;
  }
}

@media (max-width: 480px) {
  .asset-grid {
    grid-template-columns: 1fr;
  }
  
  .asset-grid.grid-3,
  .asset-grid.grid-4,
  .asset-grid.grid-5 {
    grid-template-columns: 1fr;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .grid-size-control {
    display: none;
  }
}

/* Help Modal Styles */
.help-container {
  padding: 1.5rem 0;
  max-width: 100%;
  margin-top: 6rem;
}

.help-section {
  margin-bottom: 2rem;
  margin-top: 4rem;
}

.help-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.help-icon {
  font-size: 2rem;
  width: 3rem;
  height: 3rem;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--accent-color);
  border-radius: 0.75rem;
}

.help-header h3 {
  margin: 0 0 0.25rem 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--primary-text);
}

.help-header p {
  margin: 0;
  color: var(--secondary-text);
  font-size: 0.875rem;
}

.help-section h4 {
  margin: 0 0 1rem 0;
  font-size: 1rem;
  font-weight: 600;
  color: var(--primary-text);
}

.feature-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1rem;
}

.feature-card {
  background: var(--card-bg);
  border: 1px solid var(--border-primary);
  border-radius: 0.75rem;
  padding: 1.25rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  transition: all 0.2s ease;
}

.feature-card:hover {
  border-color: var(--accent-color);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.feature-icon {
  font-size: 1.5rem;
  margin-bottom: 0.25rem;
}

.feature-card strong {
  color: var(--primary-text);
  font-size: 0.9rem;
  font-weight: 600;
}

.feature-card span {
  color: var(--secondary-text);
  font-size: 0.8rem;
  line-height: 1.4;
}

.shortcuts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 0.75rem;
}

.shortcut-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  background: var(--secondary-bg);
  border-radius: 0.5rem;
  border: 1px solid var(--border-primary);
}

.shortcut-item span {
  color: var(--primary-text);
  font-size: 0.875rem;
}

.shortcut-item kbd {
  background: var(--card-bg);
  border: 1px solid var(--border-primary);
  border-radius: 0.25rem;
  padding: 0.25rem 0.5rem;
  font-family: 'Courier New', monospace;
  font-size: 0.75rem;
  color: var(--accent-color);
  font-weight: 600;
}

.navigation-list {
  display: grid;
  gap: 0.75rem;
}

.nav-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  background: var(--secondary-bg);
  border-radius: 0.5rem;
  border: 1px solid var(--border-primary);
}

.nav-action {
  color: var(--primary-text);
  font-weight: 500;
  font-size: 0.875rem;
}

.nav-result {
  color: var(--secondary-text);
  font-size: 0.8rem;
  font-family: 'Courier New', monospace;
}

  </style>
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="https://numerimondes.github.io/.github/">
        <div class="logo-section">
          <img src="https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=https://numerimondes.com/&size=256" class="logo-image" height="100%"/>
          <h1 class="logo-title">Asset Viewer</h1>
          <span id="loading-badge" class="loading-badge" style="display: none;">Loading...</span>
        </div>
        </a>
        <div class="header-controls">
          <!-- View Toggle -->
          <div class="view-toggle">
            <button class="view-toggle-btn active" data-view="grid" title="Grid View">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
              </svg>
              <span class="btn-text">Grid</span>
            </button>
            <button class="view-toggle-btn" data-view="list" title="List View">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
              </svg>
              <span class="btn-text">List</span>
            </button>
          </div>

          <!-- Grid Size Control (only visible in grid view) -->
          <div id="grid-size-control" class="grid-size-control">
            <button class="grid-size-btn" data-size="3">3</button>
            <button class="grid-size-btn active" data-size="4">4</button>
            <button class="grid-size-btn" data-size="5">5</button>
          </div>

          <!-- Filter -->
          <select id="type-filter" class="filter-select">
            <option value="">All Types</option>
            <option value="brands">Brands</option>
            <option value="clients">Clients</option>
            <option value="projects">Projects</option>
            <option value="commons">Commons</option>
          </select>

          <!-- Help Button -->
          <button class="help-btn" onclick="showHelp()">
            <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM2.75 12C2.75 9.71567 3.57804 7.62475 4.95034 6.011L8.1528 9.21346C7.58488 9.99619 7.25 10.959 7.25 12C7.25 13.041 7.58488 14.0038 8.1528 14.7865L4.95033 17.989C3.57804 16.3753 2.75 14.2843 2.75 12ZM9.21346 8.1528L6.011 4.95034C7.62475 3.57804 9.71567 2.75 12 2.75C14.2843 2.75 16.3753 3.57804 17.989 4.95034L14.7865 8.1528C14.0038 7.58488 13.041 7.25 12 7.25C10.959 7.25 9.99619 7.58488 9.21346 8.1528ZM6.01099 19.0497C7.62474 20.422 9.71567 21.25 12 21.25C14.2843 21.25 16.3753 20.422 17.989 19.0497L14.7865 15.8472C14.0038 16.4151 13.041 16.75 12 16.75C10.959 16.75 9.99619 16.4151 9.21346 15.8472L6.01099 19.0497ZM15.8472 14.7865L19.0497 17.989C20.422 16.3753 21.25 14.2843 21.25 12C21.25 9.71567 20.422 7.62475 19.0497 6.011L15.8472 9.21346C16.4151 9.99619 16.75 10.959 16.75 12C16.75 13.041 16.4151 14.0038 15.8472 14.7865ZM8.75 12C8.75 10.2051 10.2051 8.75 12 8.75C13.7949 8.75 15.25 10.2051 15.25 12C15.25 13.7949 13.7949 15.25 12 15.25C10.2051 15.25 8.75 13.7949 8.75 12Z" fill="#1C274C"></path> </g></svg>
            <span class="help-text">Help</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="total-count">0</div>
        <div class="stat-label">Total Assets</div>
      </div>
      <div class="stat-card">
        <div class="stat-value brands" id="brands-count">0</div>
        <div class="stat-label">Brands Assets</div>
      </div>
      <div class="stat-card">
        <div class="stat-value clients" id="clients-count">0</div>
        <div class="stat-label">Clients Assets</div>
      </div>
      <div class="stat-card">
        <div class="stat-value projects" id="projects-count">0</div>
        <div class="stat-label">Projects Assets</div>
      </div>
    </div>

    <!-- Search Container -->
    <div class="search-container">
      <input type="text" id="search-input" class="search-input" placeholder="Search assets by name, owner, or path..." />
      <button id="clear-search" class="clear-search-btn" style="display: none;">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Unified Horizontal Filter Container -->
    <div class="unified-filter-container">
      <div id="country-filter-grid" class="owner-filter-grid">
        <!-- Country filters will be populated here -->
      </div>
      <div id="organization-filter-grid" class="owner-filter-grid">
        <!-- Organization filters will be populated here -->
      </div>
      <div id="owner-filter-grid" class="owner-filter-grid">
        <!-- Owner filters will be populated here -->
      </div>
    </div>

    <!-- Loading State -->
    <div id="loading-state" class="loading-state">
      <div class="loading-icon">üì¶</div>
      <h3 class="loading-title">Loading Assets</h3>
      <p class="loading-description">Fetching and processing asset information from GitHub...</p>
      <div class="progress-bar">
        <div id="progress-fill" class="progress-fill"></div>
      </div>
    </div>

    <!-- Error State -->
    <div id="error-state" class="error-state" style="display: none;">
      <div class="error-icon">‚ö†Ô∏è</div>
      <h3 class="error-title">Error Loading Assets</h3>
      <p class="error-description" id="error-message">An error occurred while loading the assets.</p>
      <button onclick="loadAssets()" class="retry-btn">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
        Retry
      </button>
    </div>

    <!-- Empty State -->
    <div id="empty-state" class="empty-state" style="display: none;">
      <div class="empty-icon">üîç</div>
      <h3 class="empty-title">No Assets Found</h3>
      <p class="empty-description">No assets match your current search and filter criteria. Try adjusting your search terms or filters.</p>
    </div>

    <!-- Asset Grid -->
    <div id="asset-grid" class="asset-grid grid-4" style="display: none;"></div>

    <!-- Asset List -->
    <div id="asset-list" class="asset-list" style="display: none;"></div>
  </main>


    <!-- Footer -->
  <footer class="footer" style="text-align:center;">
  <div class="footer-content">
    <img src="https://t2.gstatic.com/faviconV2?client=SOCIAL&amp;type=FAVICON&amp;fallback_opts=TYPE,SIZE,URL&amp;url=https://numerimondes.com/&amp;size=256" 
         class="logo-image" height="100%" style="display:block; margin: 0 auto;"/>
         
    <p class="footer-text mt-5">Digital assets viewer for Numerimondes brands, clients and projects</p>
    
    <div class="footer-links">
      <!-- liens en ligne -->
      <a href="https://github.com/orgs/numerimondes/discussions" class="footer-link" target="_blank">Discussions</a>
      <a href="https://github.com/numerimondes" class="footer-link" target="_blank">GitHub</a>
      <a href="https://numerimondes.com" class="footer-link" target="_blank">Website</a>
      <a href="#" onclick="openSourceCodeModal()" class="footer-link">See the Source code</a>
      <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank" class="footer-link">Licence GNU GPL V3</a>
      </div>
    <p class="footer-copyright">
      ¬© 2023-<script>document.write(new Date().getFullYear());</script> Numerimondes. All rights reserved.
    </p>
  </div>
</footer>


  <!-- Modal for Asset Preview -->
  <div id="asset-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">Asset Preview</h3>
        <button class="modal-close" onclick="closeModal()">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="modal-preview" id="modal-preview"></div>
        <div class="modal-actions" id="modal-actions"></div>
        <div class="modal-info" id="modal-info"></div>
      </div>
    </div>
  </div>

  <script>
    // Global state
    let allAssets = [];
    let filteredAssets = [];
    let currentView = 'grid';
    let currentGridSize = 4;
    let currentFilter = '';
    let currentOrganizationFilter = '';
    let currentCountryFilter = '';
    let currentOwnerFilter = '';
    let currentSearch = '';
    let retryCount = 0;
    const maxRetries = 3;

    // DOM elements
    const loadingState = document.getElementById('loading-state');
    const errorState = document.getElementById('error-state');
    const emptyState = document.getElementById('empty-state');
    const assetGrid = document.getElementById('asset-grid');
    const assetList = document.getElementById('asset-list');
    const searchInput = document.getElementById('search-input');
    const clearSearchBtn = document.getElementById('clear-search');
    const typeFilter = document.getElementById('type-filter');
    const gridSizeControl = document.getElementById('grid-size-control');
    const loadingBadge = document.getElementById('loading-badge');
    const progressFill = document.getElementById('progress-fill');

    // File extension mappings
    const fileIcons = {
      // Images
      'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'gif': 'üé¨', 'svg': 'üìê', 'webp': 'üñºÔ∏è',
      'ico': '‚≠ê', 'bmp': 'üñºÔ∏è', 'tiff': 'üñºÔ∏è',
      
      // Documents
      'pdf': 'üìÑ', 'doc': 'üìù', 'docx': 'üìù', 'txt': 'üìÑ', 'md': 'üìù', 'readme': 'üìñ',
      
      // Archives
      'zip': 'üì¶', 'rar': 'üì¶', 'tar': 'üì¶', 'gz': 'üì¶', '7z': 'üì¶',
      
      // Code
      'js': 'üíª', 'html': 'üåê', 'css': 'üé®', 'json': '‚öôÔ∏è', 'xml': 'üìã',
      
      // Audio
      'mp3': 'üéµ', 'wav': 'üéµ', 'flac': 'üéµ', 'aac': 'üéµ',
      
      // Video
      'mp4': 'üé¨', 'avi': 'üé¨', 'mov': 'üé¨', 'wmv': 'üé¨', 'mkv': 'üé¨',
      
      // Fonts
      'ttf': 'üî§', 'otf': 'üî§', 'woff': 'üî§', 'woff2': 'üî§',
      
      // Default
      'default': 'üìÅ'
    };

    // Default image for files
    const defaultSourceImage = 'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg';

    // Card preview images for files - easily customizable
    const cardPreviewImages = {
      // Source files - always show sample images on cards
      'svg': 'https://linuxiac.b-cdn.net/wp-content/uploads/2024/10/inkscape14-app.jpg',
      'psd': 'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg',
      'ai': 'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg',
      'kdenlive': 'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg',
      'tex': 'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg',
      'latex': 'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg',
      
      // Non-source files - also can have card images
      'pdf': 'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg'
    };

    // Modal preview images for files - separate control
    const modalPreviewImages = {
      // Source files that should show images in modal (not readable content)
      'svg': 'https://media.inkscape.org/media/shields/backgrounds/Winner_Inkscapes_Path-Artists_Blossom_1.4.2_for_releases_app_2200.png',
      'psd': 'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg',
      'ai': 'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg',
      'kdenlive': 'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg',
      
      // Note: 'tex', 'latex' not included here - they will show content instead of image
      // Note: 'pdf' not included here - it will show content/original instead of image
    };

    // Extensions that are readable/previewable in modal
    const readableExtensions = ['md', 'txt', 'json', 'pdf', 'jpg', 'jpeg', 'png', 'gif', 'svg', 'webp', 'mp4', 'avi', 'mov'];

    // Check if file is a source file
    function isSourceFile(path) {
      return path.includes('sources/');
    }

    // Get preview image for card
    function getCardPreviewImage(asset) {
      console.log('Getting card preview for:', asset.filename, 'isSourceFile:', asset.isSourceFile, 'extension:', asset.extension);
      
      // Check if there's a specific card image for this extension
      if (cardPreviewImages[asset.extension]) {
        console.log('Found card preview image for extension:', asset.extension);
        return cardPreviewImages[asset.extension];
      }
      
      // For source files without specific card image, use default
      if (asset.isSourceFile) {
        console.log('Source file without specific card image, using default');
        return defaultSourceImage;
      }
      
      // For regular images, use original
      if (asset.isImage) {
        console.log('Using original image URL');
        return asset.url;
      }
      
      console.log('No preview image found, returning null');
      return null;
    }

    // Get preview image for modal
    function getModalPreviewImage(asset) {
      console.log('Getting modal preview for:', asset.filename, 'isSourceFile:', asset.isSourceFile, 'extension:', asset.extension);
      
      // Check if there's a specific modal image for this extension
      if (modalPreviewImages[asset.extension]) {
        console.log('Found modal preview image for extension:', asset.extension);
        return modalPreviewImages[asset.extension];
      }
      
      // For readable files, we'll load their content instead (no image)
      if (readableExtensions.includes(asset.extension)) {
        console.log('Readable extension, will load content instead');
        return null; // Will load content instead
      }
      
      // For regular images, use original
      if (asset.isImage) {
        console.log('Using original image URL for modal');
        return asset.url;
      }
      
      // For other files, use default
      console.log('Using default image for modal');
      return defaultSourceImage;
    }

    // Format owner name for display
    function formatOwnerName(owner) {
      return owner
        .replace(/[-_]/g, ' ')
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
        .join(' ');
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      setupEventListeners();
      loadAssets();
    });

    function setupEventListeners() {
      // View toggle
      document.querySelectorAll('.view-toggle-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const view = e.currentTarget.dataset.view;
          switchView(view);
        });
      });

      // Grid size control
      document.querySelectorAll('.grid-size-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const size = parseInt(e.currentTarget.dataset.size);
          setGridSize(size);
        });
      });

      // Search functionality
      searchInput.addEventListener('input', handleSearch);
      clearSearchBtn.addEventListener('click', clearSearch);

      // Filter functionality
      typeFilter.addEventListener('change', handleFilter);

      // Modal functionality
      window.addEventListener('click', (e) => {
        const modal = document.getElementById('asset-modal');
        if (e.target === modal) {
          closeModal();
        }
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeModal();
        }
      });
    }

    async function loadAssets() {
      try {
        showLoading();
        retryCount++;

        const response = await fetch('https://raw.githubusercontent.com/numerimondes/.github/refs/heads/main/assets/commons/config/assets-links.txt');
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        updateProgress(30);
        
        const text = await response.text();
        
        if (!text.trim()) {
          throw new Error('Asset configuration file is empty');
        }

        updateProgress(60);
        
        // Parse the asset links
        const lines = text.split('\n').filter(line => line.trim());
        allAssets = parseAssetLinks(lines);
        
        if (allAssets.length === 0) {
          throw new Error('No valid assets found in configuration file');
        }

        updateProgress(90);
        
        // Process and validate assets
        await validateAssets();
        
        updateProgress(100);
        
        filteredAssets = [...allAssets];
        updateStats();
        updateOrganizationFilter();
        updateCountryFilter();
        updateOwnerFilter();
        renderAssets();
        hideLoading();
        retryCount = 0; // Reset retry count on success

      } catch (error) {
        console.error('Error loading assets:', error);
        showError(error.message);
      }
    }

    function parseAssetLinks(lines) {
      const assets = [];
      
      lines.forEach((line, index) => {
        try {
          const trimmedLine = line.trim();
          
          // Skip comments and empty lines
          if (!trimmedLine || trimmedLine.startsWith('#') || trimmedLine.startsWith('//')) {
            return;
          }

          // Handle different URL formats
          let url = trimmedLine;
          
          // Extract URL if it's in markdown format [text](url)
          const markdownMatch = trimmedLine.match(/\[.*?\]\((.*?)\)/);
          if (markdownMatch) {
            url = markdownMatch[1];
          }
          
          // Validate URL
          if (!isValidAssetUrl(url)) {
            console.warn(`Invalid asset URL at line ${index + 1}: ${url}`);
            return;
          }

          const asset = createAssetFromUrl(url);
          if (asset) {
            assets.push(asset);
          }
          
        } catch (error) {
          console.warn(`Error parsing line ${index + 1}: ${line}`, error);
        }
      });

      return assets;
    }

    function isValidAssetUrl(url) {
      try {
        const urlObj = new URL(url);
        return urlObj.hostname === 'raw.githubusercontent.com' && 
               urlObj.pathname.includes('/numerimondes/.github/') &&
               urlObj.pathname.includes('/assets/');
      } catch {
        return false;
      }
    }

    function createAssetFromUrl(url) {
      try {
        const urlObj = new URL(url);
        const pathParts = urlObj.pathname.split('/').filter(part => part);
        
        // Expected format: /numerimondes/.github/refs/heads/main/assets/{type}/...
        const assetsIndex = pathParts.indexOf('assets');
        if (assetsIndex === -1 || assetsIndex + 1 >= pathParts.length) {
          console.warn('Invalid asset path format:', url);
          return null;
        }

        const type = pathParts[assetsIndex + 1]; // brands, clients, projects, commons
        let owner, remainingPath;
        
        if (type === 'clients') {
          // For clients: assets/clients/{country}/{organization}/{owner}/...
          if (assetsIndex + 4 >= pathParts.length) {
            console.warn('Invalid client asset path format:', url);
            return null;
          }
          const country = pathParts[assetsIndex + 2];
          const organization = pathParts[assetsIndex + 3];
          owner = pathParts[assetsIndex + 4];
          // For clients, path includes country/organization/owner/remaining
          remainingPath = pathParts.slice(assetsIndex + 2).join('/');
        } else {
          // For brands/projects/commons: assets/{type}/{owner}/...
          if (assetsIndex + 2 >= pathParts.length) {
            console.warn('Invalid asset path format:', url);
            return null;
          }
          owner = pathParts[assetsIndex + 2];
          remainingPath = pathParts.slice(assetsIndex + 3).join('/');
        }
        
        const filename = pathParts[pathParts.length - 1];
        const extension = filename.includes('.') ? filename.split('.').pop().toLowerCase() : '';
        const isSourceFileFlag = isSourceFile(remainingPath);

        // Skip if not a valid type
        if (!['brands', 'clients', 'projects', 'commons'].includes(type)) {
          console.warn('Invalid asset type:', type);
          return null;
        }

        return {
          id: generateId(url),
          url: url,
          filename: filename,
          title: formatTitle(filename),
          type: type,
          owner: owner,
          path: remainingPath,
          fullPath: pathParts.slice(assetsIndex).join('/'),
          extension: extension,
          isImage: isImageFile(extension),
          isReadme: isReadmeFile(filename),
          isSourceFile: isSourceFileFlag,
          icon: getFileIcon(extension, filename),
          formattedOwner: formatOwnerName(owner)
        };
        
      } catch (error) {
        console.warn('Error creating asset from URL:', url, error);
        return null;
      }
    }

    function generateId(url) {
      return btoa(url).replace(/[^a-zA-Z0-9]/g, '').substring(0, 16);
    }

    function formatTitle(filename) {
      return filename.replace(/[-_]/g, ' ').replace(/\.(jpg|jpeg|png|gif|svg|webp|pdf|txt|md|zip|rar)$/i, '');
    }

    function isImageFile(extension) {
      return ['jpg', 'jpeg', 'png', 'gif', 'svg', 'webp', 'ico', 'bmp', 'tiff'].includes(extension);
    }

    function isReadmeFile(filename) {
      return filename.toLowerCase().includes('readme') || filename.toLowerCase().endsWith('.md');
    }

    function getFileIcon(extension, filename) {
      if (isReadmeFile(filename)) return 'üìñ';
      return fileIcons[extension] || fileIcons.default;
    }

    async function validateAssets() {
      // Simple validation - could be expanded to check if URLs are accessible
      const validAssets = allAssets.filter(asset => asset && asset.url && asset.type && asset.owner);
      allAssets = validAssets;
    }

    function updateStats() {
      // Only count filtered assets for display, excluding commons unless specifically selected
      let assetsToCount = filteredAssets;
      if (currentFilter !== 'commons') {
        assetsToCount = filteredAssets.filter(asset => asset.type !== 'commons');
      }
      
      const stats = {
        total: assetsToCount.length,
        brands: assetsToCount.filter(asset => asset.type === 'brands').length,
        clients: assetsToCount.filter(asset => asset.type === 'clients').length,
        projects: assetsToCount.filter(asset => asset.type === 'projects').length
      };

      document.getElementById('total-count').textContent = stats.total;
      document.getElementById('brands-count').textContent = stats.brands;
      document.getElementById('clients-count').textContent = stats.clients;
      document.getElementById('projects-count').textContent = stats.projects;
    }

    // Get countries for clients
    function getCountriesForClients() {
      const countries = new Set();
      allAssets.forEach(asset => {
        if (asset.type === 'clients') {
          // Path structure: country/organization/owner/...
          const pathParts = asset.path.split('/');
          if (pathParts.length > 0) {
            countries.add(pathParts[0]);
          }
        }
      });
      return Array.from(countries).sort();
    }

    // Get organization types for clients by country
    function getOrganizationTypesForClients(country = '') {
      const organizations = new Set();
      allAssets.forEach(asset => {
        if (asset.type === 'clients') {
          const pathParts = asset.path.split('/');
          if (country && pathParts[0] === country && pathParts.length > 1) {
            organizations.add(pathParts[1]);
          } else if (!country && pathParts.length > 1) {
            organizations.add(pathParts[1]);
          }
        }
      });
      return Array.from(organizations).sort();
    }

    // Get owners for type/country/organization
    function getOwnersForType(type, country = '', organization = '') {
      if (!type) return [];
      
      const owners = new Set();
      allAssets.forEach(asset => {
        if (asset.type === type) {
          if (type === 'clients') {
            const pathParts = asset.path.split('/');
            let matches = true;
            
            if (country && pathParts[0] !== country) matches = false;
            if (organization && pathParts[1] !== organization) matches = false;
            
            if (matches) {
              owners.add(asset.owner);
            }
          } else {
            owners.add(asset.owner);
          }
        }
      });
      
      return Array.from(owners).sort();
    }

    function getOwnerEmoji(type) {
      switch(type) {
        case 'clients': return 'üë§';
        case 'projects': return 'üìÅ';
        case 'brands': return 'üî∫';
        default: return 'üìÇ';
      }
    }

    function updateOrganizationFilter() {
      const organizationGrid = document.getElementById('organization-filter-grid');
      
      // Show organizations ONLY if country selected AND no organization selected
      if (currentFilter !== 'clients' || !currentCountryFilter || currentOrganizationFilter) {
        organizationGrid.style.display = 'none';
        return;
      }
      
      const organizations = getOrganizationTypesForClients(currentCountryFilter);
      if (organizations.length === 0) {
        organizationGrid.style.display = 'none';
        return;
      }
      
      organizationGrid.style.display = 'flex';
      organizationGrid.innerHTML = '';
      
      // Add back button as first item
      const backItem = document.createElement('div');
      backItem.className = 'owner-filter-item';
      backItem.innerHTML = `
        <div class="owner-filter-emoji">‚Üê</div>
        <div class="owner-filter-name">Back to Countries</div>
      `;
      backItem.onclick = () => selectCountryFilter('');
      organizationGrid.appendChild(backItem);
      
      // Add "All Organizations" option
      const allItem = document.createElement('div');
      allItem.className = `owner-filter-item ${!currentOrganizationFilter ? 'active' : ''}`;
      allItem.innerHTML = `
        <div class="owner-filter-emoji">üè¢</div>
        <div class="owner-filter-name">All Organizations</div>
      `;
      allItem.onclick = () => selectOrganizationFilter('');
      organizationGrid.appendChild(allItem);
      
      // Add organization options
      organizations.forEach(organization => {
        const item = document.createElement('div');
        item.className = `owner-filter-item ${currentOrganizationFilter === organization ? 'active' : ''}`;
        
        item.innerHTML = `
          <div class="owner-filter-emoji">üè¢</div>
          <div class="owner-filter-name">${formatOwnerName(organization)}</div>
        `;
        
        item.onclick = () => selectOrganizationFilter(organization);
        organizationGrid.appendChild(item);
      });
    }

    function updateCountryFilter() {
      const countryGrid = document.getElementById('country-filter-grid');
      
      // Show countries ONLY if clients filter AND no country/organization selected
      if (currentFilter !== 'clients' || currentCountryFilter || currentOrganizationFilter) {
        countryGrid.style.display = 'none';
        return;
      }
      
      const countries = getCountriesForClients();
      if (countries.length === 0) {
        countryGrid.style.display = 'none';
        return;
      }
      
      countryGrid.style.display = 'flex';
      countryGrid.innerHTML = '';
      
      // Add "All Countries" option
      const allItem = document.createElement('div');
      allItem.className = `owner-filter-item ${!currentCountryFilter ? 'active' : ''}`;
      allItem.innerHTML = `
        <div class="owner-filter-emoji">üåç</div>
        <div class="owner-filter-name">All Countries</div>
      `;
      allItem.onclick = () => selectCountryFilter('');
      countryGrid.appendChild(allItem);
      
      // Add country options
      countries.forEach(country => {
        const item = document.createElement('div');
        item.className = `owner-filter-item ${currentCountryFilter === country ? 'active' : ''}`;
        
        item.innerHTML = `
          <div class="owner-filter-emoji">üåç</div>
          <div class="owner-filter-name">${formatOwnerName(country)}</div>
        `;
        
        item.onclick = () => selectCountryFilter(country);
        countryGrid.appendChild(item);
      });
    }

    function updateOwnerFilter() {
      const ownerGrid = document.getElementById('owner-filter-grid');
      
      if (!currentFilter || currentFilter === 'commons') {
        ownerGrid.style.display = 'none';
        return;
      }
      
      // For clients, only show if organization is selected
      if (currentFilter === 'clients' && !currentOrganizationFilter) {
        ownerGrid.style.display = 'none';
        return;
      }
      
      const owners = getOwnersForType(currentFilter, currentCountryFilter, currentOrganizationFilter);
      if (owners.length === 0) {
        ownerGrid.style.display = 'none';
        return;
      }
      
      ownerGrid.style.display = 'flex';
      ownerGrid.innerHTML = '';
      
      // Add back button for clients as first item
      if (currentFilter === 'clients' && currentOrganizationFilter) {
        const backItem = document.createElement('div');
        backItem.className = 'owner-filter-item';
        backItem.innerHTML = `
          <div class="owner-filter-emoji">‚Üê</div>
          <div class="owner-filter-name">Back to Organizations</div>
        `;
        backItem.onclick = () => selectOrganizationFilter('');
        ownerGrid.appendChild(backItem);
      }
      
      // Add "All" option
      const allItem = document.createElement('div');
      allItem.className = `owner-filter-item ${!currentOwnerFilter ? 'active' : ''}`;
      allItem.innerHTML = `
        <div class="owner-filter-emoji">üåê</div>
        <div class="owner-filter-name">All</div>
      `;
      allItem.onclick = () => selectOwnerFilter('');
      ownerGrid.appendChild(allItem);
      
      // Add owner options
      owners.forEach(owner => {
        const item = document.createElement('div');
        item.className = `owner-filter-item ${currentOwnerFilter === owner ? 'active' : ''}`;
        
        const logoUrl = `https://raw.githubusercontent.com/numerimondes/.github/refs/heads/main/assets/${currentFilter}/${owner}/logo.png`;
        
        // For clients, use emoji directly, for other types try logo first
        if (currentFilter === 'clients') {
          item.innerHTML = `
            <div class="owner-filter-emoji">${getOwnerEmoji(currentFilter)}</div>
            <div class="owner-filter-name">${formatOwnerName(owner)}</div>
          `;
        } else {
          item.innerHTML = `
            <img src="${logoUrl}" class="owner-filter-logo" 
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div class="owner-filter-emoji" style="display:none;">${getOwnerEmoji(currentFilter)}</div>
            <div class="owner-filter-name">${formatOwnerName(owner)}</div>
          `;
        }
        
        item.onclick = () => selectOwnerFilter(owner);
        ownerGrid.appendChild(item);
      });
    }

    function selectOrganizationFilter(organization) {
      currentOrganizationFilter = organization;
      currentCountryFilter = ''; // Reset subsequent filters
      currentOwnerFilter = '';
      updateCountryFilter();
      updateOwnerFilter();
      applyFilters();
      updateOrganizationFilter();
    }

    function selectCountryFilter(country) {
      currentCountryFilter = country;
      currentOrganizationFilter = ''; // Reset organization filter when country changes
      currentOwnerFilter = ''; // Reset owner filter when country changes
      updateOrganizationFilter(); // Show organization types for selected country
      updateOwnerFilter();
      applyFilters();
      updateCountryFilter();
    }

    function selectOwnerFilter(owner) {
      currentOwnerFilter = owner;
      applyFilters();
      updateOwnerFilter();
    }

    function renderAssets() {
      if (filteredAssets.length === 0) {
        showEmpty();
        return;
      }

      hideAllStates();

      if (currentView === 'grid') {
        renderGridView();
      } else {
        renderListView();
      }
    }

    function renderGridView() {
      assetGrid.style.display = 'grid';
      assetGrid.innerHTML = '';

      filteredAssets.forEach(asset => {
        const card = createAssetCard(asset);
        assetGrid.appendChild(card);
      });
    }

    function renderListView() {
      assetList.style.display = 'flex';
      assetList.innerHTML = '';

      filteredAssets.forEach(asset => {
        const item = createAssetListItem(asset);
        assetList.appendChild(item);
      });
    }

    function createAssetCard(asset) {
      const card = document.createElement('div');
      card.className = 'asset-card';
      card.onclick = () => openAssetModal(asset);

      card.innerHTML = `
        <div class="asset-card-header">
          <span class="asset-type-badge ${asset.type}">${asset.type}</span>
        </div>
        <div class="asset-preview">
          ${(() => {
            const previewImage = getCardPreviewImage(asset);
            console.log('Card preview result for', asset.filename, ':', previewImage);
            if (previewImage) {
              return `<img src="${previewImage}"  onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                      <div class="asset-placeholder" style="display:none;">${asset.icon}</div>`;
            } else {
              return `<div class="asset-placeholder">${asset.icon}</div>`;
            }
          })()}
          <div class="asset-actions">
            <button class="action-btn" onclick="event.stopPropagation(); copyAssetUrl('${asset.url}')" title="Copy URL">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
              </svg>
            </button>
            <button class="action-btn" onclick="event.stopPropagation(); downloadAsset('${asset.url}', '${asset.filename}')" title="Download">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="asset-info">
          <div class="asset-title">${asset.title}</div>
          <div class="asset-path">${asset.formattedOwner}</div>
        </div>
      `;

      return card;
    }

    function createAssetListItem(asset) {
      const item = document.createElement('div');
      item.className = 'asset-list-item';
      item.onclick = () => openAssetModal(asset);

      item.innerHTML = `
        <div class="asset-list-preview">
          ${(() => {
            const previewImage = getCardPreviewImage(asset);
            if (previewImage) {
              return `<img src="${previewImage}"  onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                      <div class="asset-placeholder" style="display:none;">${asset.icon}</div>`;
            } else {
              return `<div class="asset-placeholder">${asset.icon}</div>`;
            }
          })()}
        </div>
        <div class="asset-list-info">
          <div class="asset-list-title">${asset.title}</div>
          <div class="asset-list-path">${asset.formattedOwner}</div>
        </div>
        <div class="asset-list-badge">
          <span class="asset-type-badge ${asset.type}">${asset.type}</span>
        </div>
        <div class="asset-actions">
          <button class="action-btn" onclick="event.stopPropagation(); copyAssetUrl('${asset.url}')" title="Copy URL">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
          </button>
          <button class="action-btn" onclick="event.stopPropagation(); downloadAsset('${asset.url}', '${asset.filename}')" title="Download">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
          </button>
        </div>
      `;

      return item;
    }

    async function openAssetModal(asset) {
      const modal = document.getElementById('asset-modal');
      const modalTitle = document.getElementById('modal-title');
      const modalPreview = document.getElementById('modal-preview');
      const modalActions = document.getElementById('modal-actions');
      const modalInfo = document.getElementById('modal-info');

      modalTitle.textContent = asset.title;

      // Create action buttons
      modalActions.innerHTML = `
        <button class="modal-action-btn" onclick="copyAssetUrl('${asset.url}')">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
          </svg>
          Copy URL
        </button>
        <button class="modal-action-btn secondary" onclick="downloadAsset('${asset.url}', '${asset.filename}')">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          Download
        </button>
      `;

      // Handle preview based on file type
      const modalImage = getModalPreviewImage(asset);
      console.log('Modal preview image for', asset.filename, ':', modalImage);
      
      // FORCE: Source files always use sample image in modal
      if (asset.isSourceFile) {
        const sampleImg = modalImage || defaultSourceImage;
        console.log('Using sample image for source file in modal:', sampleImg);
        modalPreview.innerHTML = `<img src="${sampleImg}"  onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"><div class="asset-placeholder" style="display:none; font-size: 4rem;">${asset.icon}</div>`;
      } else if (asset.isImage) {
        modalPreview.innerHTML = `<img src="${asset.url}"  onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"><div class="asset-placeholder" style="display:none; font-size: 4rem;">${asset.icon}</div>`;
      } else if (asset.isReadme || readableExtensions.includes(asset.extension)) {
        // For readable files, fetch and display content
        try {
          const response = await fetch(asset.url);
          const content = await response.text();
          modalPreview.innerHTML = `<div class="markdown-content"><pre><code>${escapeHtml(content)}</code></pre></div>`;
        } catch (error) {
          if (modalImage) {
            modalPreview.innerHTML = `<img src="${modalImage}"  onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"><div class="asset-placeholder" style="display:none; font-size: 4rem;">${asset.icon}</div>`;
          } else {
            modalPreview.innerHTML = `<div class="asset-placeholder" style="font-size: 4rem;">${asset.icon}</div>`;
          }
        }
      } else if (modalImage) {
        modalPreview.innerHTML = `<img src="${modalImage}"  onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"><div class="asset-placeholder" style="display:none; font-size: 4rem;">${asset.icon}</div>`;
      } else {
        modalPreview.innerHTML = `<div class="asset-placeholder" style="font-size: 4rem;">${asset.icon}</div>`;
      }

      // Set modal info
      modalInfo.innerHTML = `
        <div class="modal-info-item">
          <div class="modal-info-label">Type:</div>
          <div class="modal-info-value">${asset.type}</div>
        </div>
        <div class="modal-info-item">
          <div class="modal-info-label">Owner:</div>
          <div class="modal-info-value">${asset.owner}</div>
        </div>
        <div class="modal-info-item">
          <div class="modal-info-label">Filename:</div>
          <div class="modal-info-value">${asset.filename}</div>
        </div>
        <div class="modal-info-item">
          <div class="modal-info-label">Path:</div>
          <div class="modal-info-value">${asset.fullPath}</div>
        </div>
        <div class="modal-info-item">
          <div class="modal-info-label">URL:</div>
          <div class="modal-info-value">${asset.url}</div>
        </div>
      `;

      modal.classList.add('show');
    }

    function closeModal() {
      const modal = document.getElementById('asset-modal');
      modal.classList.remove('show');
    }

    function copyAssetUrl(url) {
      navigator.clipboard.writeText(url).then(() => {
        // Could add a toast notification here
        console.log('URL copied to clipboard:', url);
      }).catch(err => {
        console.error('Failed to copy URL:', err);
      });
    }

    function downloadAsset(url, filename) {
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      link.target = '_blank';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function switchView(view) {
      currentView = view;
      
      // Update button states
      document.querySelectorAll('.view-toggle-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === view);
      });

      // Show/hide grid size control
      gridSizeControl.style.display = view === 'grid' ? 'flex' : 'none';

      renderAssets();
    }

    function setGridSize(size) {
      currentGridSize = size;
      
      // Update button states
      document.querySelectorAll('.grid-size-btn').forEach(btn => {
        btn.classList.toggle('active', parseInt(btn.dataset.size) === size);
      });

      // Update grid class
      assetGrid.className = `asset-grid grid-${size}`;
    }

    function handleSearch() {
      currentSearch = searchInput.value.toLowerCase();
      clearSearchBtn.style.display = currentSearch ? 'block' : 'none';
      filterAssets();
    }

    function clearSearch() {
      searchInput.value = '';
      currentSearch = '';
      clearSearchBtn.style.display = 'none';
      filterAssets();
    }

    function handleFilter() {
      currentFilter = typeFilter.value;
      currentOrganizationFilter = '';
      currentCountryFilter = '';
      currentOwnerFilter = '';
      updateOrganizationFilter();
      updateCountryFilter();
      updateOwnerFilter();
      applyFilters();
    }

    function applyFilters() {
      // Show skeleton loading for instant feedback
      showSkeletonLoading();
      
      // Use requestAnimationFrame for smooth transitions
      requestAnimationFrame(() => {
        filteredAssets = allAssets.filter(asset => {
          // Exclude commons unless specifically filtering for commons
          if (asset.type === 'commons' && currentFilter !== 'commons') {
            return false;
          }
          
          if (currentSearch) {
            // Convert search terms to handle spaces as potential - or _
            const searchTerms = currentSearch.toLowerCase().split(' ').map(term => {
              return term.replace(/[-_]/g, '[ _-]');
            });
            
            const searchableText = [
              asset.title.toLowerCase(),
              asset.owner.toLowerCase(),
              asset.formattedOwner.toLowerCase(),
              asset.path.toLowerCase(),
              asset.filename.toLowerCase()
            ].join(' ');
            
            const matchesSearch = searchTerms.every(term => {
              const regex = new RegExp(term, 'i');
              return regex.test(searchableText);
            });
            
            if (!matchesSearch) return false;
          }

          const matchesFilter = !currentFilter || asset.type === currentFilter;
          
          // For clients, check country > organization > owner hierarchy
          let matchesHierarchy = true;
          if (currentFilter === 'clients') {
            const pathParts = asset.path.split('/');
            
            if (currentCountryFilter && pathParts[0] !== currentCountryFilter) {
              matchesHierarchy = false;
            }
            if (currentOrganizationFilter && pathParts[1] !== currentOrganizationFilter) {
              matchesHierarchy = false;
            }
          }
          
          const matchesOwner = !currentOwnerFilter || asset.owner === currentOwnerFilter;
          
          return matchesFilter && matchesHierarchy && matchesOwner;
        });

        // Small delay for skeleton effect then smooth reveal
        setTimeout(() => {
          updateStats();
          renderAssets();
          hideSkeletonLoading();
        }, 100);
      });
    }

    function filterAssets() {
      applyFilters();
    }

    function showLoading() {
      hideAllStates();
      loadingState.style.display = 'block';
      loadingBadge.style.display = 'inline-block';
    }

    function hideLoading() {
      loadingState.style.display = 'none';
      loadingBadge.style.display = 'none';
    }

    function showSkeletonLoading() {
      const assetGrid = document.getElementById('asset-grid');
      const assetList = document.getElementById('asset-list');
      
      // Add skeleton loading class with instant opacity change
      assetGrid.style.opacity = '0.3';
      assetList.style.opacity = '0.3';
      assetGrid.style.filter = 'blur(1px)';
      assetList.style.filter = 'blur(1px)';
      assetGrid.style.transition = 'none';
      assetList.style.transition = 'none';
    }

    function hideSkeletonLoading() {
      const assetGrid = document.getElementById('asset-grid');
      const assetList = document.getElementById('asset-list');
      
      // Smooth reveal with animation
      assetGrid.style.transition = 'all 0.2s ease-out';
      assetList.style.transition = 'all 0.2s ease-out';
      assetGrid.style.opacity = '1';
      assetList.style.opacity = '1';
      assetGrid.style.filter = 'none';
      assetList.style.filter = 'none';
    }

    function showError(message) {
      hideAllStates();
      errorState.style.display = 'block';
      document.getElementById('error-message').textContent = message;
    }

    function showEmpty() {
      hideAllStates();
      emptyState.style.display = 'block';
    }

    function hideAllStates() {
      loadingState.style.display = 'none';
      errorState.style.display = 'none';
      emptyState.style.display = 'none';
      assetGrid.style.display = 'none';
      assetList.style.display = 'none';
    }

    function updateProgress(percentage) {
      progressFill.style.width = `${percentage}%`;
    }

    // Show help modal
    function showHelp() {
      const helpContent = `
        <div class="help-container">
          <div class="help-section">
            <div class="help-header">
              <div class="help-icon">üìñ</div>
              <div>
                <h3>About Asset Viewer</h3>
                <p>Explore and manage all digital assets from Numerimondes ecosystem</p>
              </div>
            </div>
          </div>
                
          <div class="help-section">
            <h4>Key Features</h4>
            <div class="feature-grid">
              <div class="feature-card">
                <div class="feature-icon">üîç</div>
                <strong>Smart Search</strong>
                <span>Real-time filtering by name, owner, or path</span>
              </div>
              <div class="feature-card">
                <div class="feature-icon">üè∑Ô∏è</div>
                <strong>Category Filters</strong>
                <span>Brands, Clients, Projects with hierarchy</span>
              </div>
              <div class="feature-card">
                <div class="feature-icon">üì±</div>
                <strong>Adaptive Layout</strong>
                <span>Grid columns: 3, 4, or 5 responsive</span>
              </div>
              <div class="feature-card">
                <div class="feature-icon">‚ö°</div>
                <strong>Instant Preview</strong>
                <span>Quick view with download & copy</span>
              </div>
            </div>
          </div>
                
          <div class="help-section">
            <h4>Keyboard Shortcuts</h4>
            <div class="shortcuts-grid">
              <div class="shortcut-item">
                <span>Close modal</span>
                <kbd>Esc</kbd>
              </div>
              <div class="shortcut-item">
                <span>Focus search</span>
                <kbd>Ctrl + F</kbd>
              </div>
              <div class="shortcut-item">
                <span>Clear search</span>
                <kbd>Ctrl + K</kbd>
              </div>
              <div class="shortcut-item">
                <span>Help</span>
                <kbd>?</kbd>
              </div>
            </div>
          </div>
                
          <div class="help-section">
            <h4>Navigation Guide</h4>
            <div class="navigation-list">
              <div class="nav-item">
                <span class="nav-action">Click asset</span>
                <span class="nav-result">‚Üí Open preview modal</span>
              </div>
              <div class="nav-item">
                <span class="nav-action">Search bar</span>
                <span class="nav-result">‚Üí Real-time filtering</span>
              </div>
              <div class="nav-item">
                <span class="nav-action">Category badges</span>
                <span class="nav-result">‚Üí Filter by type</span>
              </div>
              <div class="nav-item">
                <span class="nav-action">Owner filters</span>
                <span class="nav-result">‚Üí Drill down hierarchy</span>
              </div>
            </div>
          </div>
        </div>
      `;
      
      const modal = document.getElementById('asset-modal');
      const modalTitle = document.getElementById('modal-title');
      const modalPreview = document.getElementById('modal-preview');
      const modalActions = document.getElementById('modal-actions');
      const modalInfo = document.getElementById('modal-info');

      modalTitle.textContent = 'Help & Documentation';
      modalPreview.innerHTML = helpContent;
      modalActions.innerHTML = '';
      modalInfo.innerHTML = '';

      modal.classList.add('show');
    }
  </script>
  <script>
    async function openSourceCodeModal() {
  const modal = document.getElementById('asset-modal');
  const modalTitle = document.getElementById('modal-title');
  const modalPreview = document.getElementById('modal-preview');
  const modalActions = document.getElementById('modal-actions');
  const modalInfo = document.getElementById('modal-info');

  modalTitle.textContent = 'Source Code: index.html';

  // Add page-sourcecode-modal class for specific styling
  modal.classList.add('page-sourcecode-modal');

  // Show loading state
  modalPreview.innerHTML = `
    <div class="asset-placeholder text-6xl">üìÑ</div>
  `;
  modalActions.innerHTML = '';
  modalInfo.innerHTML = '';

  try {
    // Fetch the source code
    const response = await fetch('https://raw.githubusercontent.com/numerimondes/.github/refs/heads/main/index.html');
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    const sourceCode = await response.text();

    // Calculate number of lines
    const lineCount = sourceCode.split('\n').length;

    // Calculate character count excluding HTML comments
    const noComments = sourceCode.replace(/<!--[\s\S]*?-->/g, '');
    const charCount = noComments.length;

    // Display source code in modal
    modalPreview.innerHTML = `
      <div class="markdown-content">
        <pre><code class="language-html">${escapeHtml(sourceCode)}</code></pre>
      </div>
    `;

    // Add action buttons
    modalActions.innerHTML = `
      <button class="modal-action-btn" onclick="copySourceCode()">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
        </svg>
        Copy
      </button>
      <a href="https://raw.githubusercontent.com/numerimondes/.github/refs/heads/main/index.html" target="_blank" class="modal-action-btn secondary">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        Raw File
      </a>
    `;

    // Set modal info with line count and character count
    modalInfo.innerHTML = `
      <div class="modal-info-item">
        <div class="modal-info-label">Filename:</div>
        <div class="modal-info-value">index.html</div>
      </div>
      <div class="modal-info-item">
        <div class="modal-info-label">Path:</div>
        <div class="modal-info-value">.github/index.html</div>
      </div>
      <div class="modal-info-item">
        <div class="modal-info-label">URL:</div>
        <div class="modal-info-value">https://raw.githubusercontent.com/numerimondes/.github/refs/heads/main/index.html</div>
      </div>
      <div class="modal-info-item">
        <div class="modal-info-label">Lines:</div>
        <div class="modal-info-value">${lineCount}</div>
      </div>
      <div class="modal-info-item">
        <div class="modal-info-label">Characters:</div>
        <div class="modal-info-value">${charCount} (excluding comments)</div>
      </div>
    `;

    // Initialize syntax highlighting
    hljs.highlightAll();

    modal.classList.add('show');
  } catch (error) {
    console.error('Error fetching source code:', error);
    modalPreview.innerHTML = `
      <div class="asset-placeholder text-6xl">‚ö†Ô∏è</div>
      <p class="text-red-500">Failed to load source code: ${error.message}</p>
    `;
  }
}

function copySourceCode() {
  const codeElement = document.querySelector('#modal-preview .markdown-content pre code');
  if (codeElement) {
    const sourceCode = codeElement.textContent;
    navigator.clipboard.writeText(sourceCode).then(() => {
      console.log('Source code copied to clipboard');
    }).catch(err => {
      console.error('Failed to copy source code:', err);
    });
  }
}

function closeModal() {
  const modal = document.getElementById('asset-modal');
  modal.classList.remove('show', 'page-sourcecode-modal');
}
  </script>
</body>
</html>
